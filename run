#!/bin/bash

# Ensure the script exits if any command fails
set -e

# The root directory of the project is the directory where this script is located
PROJECT_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# Activate virtual environment if it exists
if [ -d "$PROJECT_ROOT/venv" ]; then
    source "$PROJECT_ROOT/venv/bin/activate"
fi

# Main logic to handle commands
case "$1" in
    install)
        echo "Installing dependencies..."
        python3 -m pip install --upgrade pip
        pip3 install --user -r "$PROJECT_ROOT/requirements.txt"
        echo "Installation complete."
        exit 0
        ;;
    test)
        echo "Running tests..."
        # The project spec requires a specific output format for the test command.
        # We will implement the logic for this in a later task.
        # For now, we just run pytest.
        python3 -m pytest
        ;;
    *)
        # If the argument is a file, process it. Otherwise, show usage.
        if [ -f "$1" ]; then
            python3 "$PROJECT_ROOT/src/main.py" "$1"
        else
            echo "Usage:"
            echo "./run install                # Install dependencies"
            echo "./run test                   # Run the test suite"
            echo "./run path/to/your/urls.txt  # Process URLs"
            exit 1
        fi
        ;;
esac